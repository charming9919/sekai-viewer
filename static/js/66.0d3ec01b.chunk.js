(this["webpackJsonpsekai-viewer"]=this["webpackJsonpsekai-viewer"]||[]).push([[66],{1061:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n(26),c=n(8),s=n(5),o=n.n(s),r=n(29),l=n(9),d=n(11),u=n(0),b=n(1022),p=n(43),m=n.n(p),j=n(286),h=n(1025),O=n(20),f=n(54),v=n(281),x=n(468),w=n(214),g=n(280),k=n(473),y=n(273),_=n(96),M=n(356),C=n(191),S=n(217),T=n(279),R=n(188),F=n(292),N=n(470),L=n(1062),z=n(1063),q=n(1064),E=n(1065),I=n(1066),P=n(928),W=n.n(P),A=n(472),B=n(929),D=n.n(B),V=n(930),J=n(108);t.default=function(){var e=Object(F.a)(),t=Object(R.a)().t,n=Object(O.a)(),s=Object(u.useMemo)((function(){return new b.a}),[]),p=Object(u.useState)(),P=Object(d.a)(p,2),B=P[0],H=P[1],U=Object(u.useState)(null),G=Object(d.a)(U,2),K=G[0],X=G[1],Y=Object(u.useState)(""),Q=Object(d.a)(Y,2),Z=Q[0],$=Q[1],ee=Object(u.useState)(""),te=Object(d.a)(ee,2),ne=te[0],ae=te[1],ie=Object(u.useState)(),ce=Object(d.a)(ie,2),se=ce[0],oe=ce[1],re=Object(u.useState)([]),le=Object(d.a)(re,2),de=le[0],ue=le[1],be=Object(u.useState)(null),pe=Object(d.a)(be,2),me=pe[0],je=pe[1],he=Object(u.useState)([]),Oe=Object(d.a)(he,2),fe=Oe[0],ve=Oe[1],xe=Object(u.useState)(null),we=Object(d.a)(xe,2),ge=we[0],ke=we[1],ye=Object(u.useState)(!1),_e=Object(d.a)(ye,2),Me=_e[0],Ce=_e[1],Se=Object(u.useState)(0),Te=Object(d.a)(Se,2),Re=Te[0],Fe=Te[1],Ne=Object(u.useState)(""),Le=Object(d.a)(Ne,2),ze=Le[0],qe=Le[1],Ee=Object(u.useState)(!1),Ie=Object(d.a)(Ee,2),Pe=Ie[0],We=Ie[1],Ae=Object(u.useState)(!1),Be=Object(d.a)(Ae,2),De=Be[0],Ve=Be[1],Je=Object(u.useState)(),He=Object(d.a)(Je,2),Ue=He[0],Ge=He[1],Ke=Object(u.useState)(""),Xe=Object(d.a)(Ke,2),Ye=Xe[0],Qe=Xe[1],Ze=Object(u.useState)(),$e=Object(d.a)(Ze,2),et=$e[0],tt=$e[1],nt=Object(J.c)().modelList,at=Object(u.useRef)(null),it=Object(u.useRef)(null),ct=D.a.fullscreenEnabled,st=Object(u.useCallback)((function(){if(at.current&&it.current&&se){var e=at.current.clientWidth,t=window.screen.width*window.devicePixelRatio>=n.breakpoints.values.md?9*e/16:4*e/3,a=e*window.devicePixelRatio,i=t*window.devicePixelRatio;se._modelSize=window.screen.width*window.devicePixelRatio>=n.breakpoints.values.md?1.5*a:3.5*a,it.current.style.width="".concat(e,"px"),it.current.style.height="".concat(t,"px"),it.current.width=a,it.current.height=i,se.appear({pointX:150,pointY:70})}}),[se,n.breakpoints.values.md]);Object(u.useLayoutEffect)((function(){var e=st;return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[st]),Object(u.useLayoutEffect)((function(){document.title=t("title:live2d")}),[t]),Object(u.useLayoutEffect)((function(){return at.current&&it.current&&(it.current.getContext("webgl",{preserveDrawingBuffer:!0}),H(s.initialize(void 0,{wrap:at.current,canvas:it.current}))),function(){s.release()}}),[s]),Object(u.useLayoutEffect)((function(){var e;return ct&&(e=function(){return We(!!D.a.fullscreenElement)},D.a.addEventListener("fullscreenchange",e)),function(){e&&D.a.removeEventListener("fullscreenchange",e)}}),[ct]),Object(u.useEffect)((function(){(function(){var e=Object(l.a)(o.a.mark((function e(){var n,a,i,c,s,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!B||!Z){e.next=45;break}return B.releaseAllModel(),oe(void 0),Ce(!0),Fe(0),qe(t("live2d:load_progress.model_metadata")),e.next=8,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/buildmodeldata.asset"),{responseType:"json"});case 8:return n=e.sent,a=n.data,Fe(20),qe(t("live2d:load_progress.model_texture")),e.next=14,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/").concat(a.TextureNames[0]));case 14:return Fe(40),qe(t("live2d:load_progress.model_moc3")),e.next=18,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/").concat(a.Moc3FileName));case 18:return Fe(60),qe(t("live2d:load_progress.model_physics")),e.next=22,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/").concat(a.PhysicsFileName));case 22:if(Z.startsWith("normal")){e.next=32;break}return Fe(80),qe(t("live2d:load_progress.motion_metadata")),e.next=27,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/motion/").concat(ne,"_rip/BuildMotionData.json"),{responseType:"json"});case 27:c=e.sent,s=c.data,i=s,e.next=33;break;case 32:i={motions:[],expressions:[]};case 33:return Fe(90),qe(t("live2d:load_progress.display_model")),l=a.Moc3FileName.replace(".moc3.bytes",""),e.next=38,B.addModel({path:"".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/"),fileName:l,modelName:Z,modelSize:at.current.clientWidth,textures:[],motions:[].concat(Object(r.a)(i.motions.map((function(e){return{name:e,url:"".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/motion/").concat(ne,"_rip/").concat(e,".motion3.json")}}))),Object(r.a)(i.expressions.map((function(e){return{name:e,url:"".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/motion/").concat(ne,"_rip/").concat(e,".motion3.json")}})))),expressions:[]},!0);case 38:d=e.sent,ue(i.motions),ve(i.expressions),d&&oe(d),Ce(!1),Fe(0),qe("");case 45:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[B,Z,ne,t]);var ot=Object(u.useCallback)(Object(l.a)(o.a.mark((function e(){var n,a,i,s,l,u,b,p,j,h,O,f,v,x,w,g,k,y;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ce(!0),Fe(0),qe(t("live2d:pack_progress.generate_metadata")),n=new W.a,e.next=6,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/buildmodeldata.asset"),{responseType:"json"});case 6:return a=e.sent,i=a.data,s={Version:3,FileReferences:{Moc:"".concat(Z,".moc3"),Textures:["".concat(Z,".2048/texture_00.png")],Physics:"".concat(Z,".physics3.json"),Motions:[].concat(Object(r.a)(de),Object(r.a)(fe)).reduce((function(e,t){return Object.assign({},e,Object(c.a)({},t,[{File:"motions/".concat(t,".motion3.json"),FadeInTime:.5,FadeOutTime:.5}]))}),{})},Groups:[{Target:"Parameter",Name:"EyeBlink",Ids:[]},{Target:"Parameter",Name:"LipSync",Ids:[]}]},n.file("".concat(Z,".model3.json"),JSON.stringify(s,null,2)),Fe(10),qe(t("live2d:pack_progress.download_texture")),e.next=14,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/").concat(i.TextureNames[0]),{responseType:"blob"});case 14:return l=e.sent,u=l.data,n.file(s.FileReferences.Textures[0],u),Fe(20),qe(t("live2d:pack_progress.download_moc3")),e.next=21,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/").concat(i.Moc3FileName),{responseType:"blob"});case 21:return b=e.sent,p=b.data,n.file(s.FileReferences.Moc,p),Fe(30),qe(t("live2d:pack_progress.download_physics")),e.next=28,m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/model/").concat(Z,"_rip/").concat(i.PhysicsFileName),{responseType:"blob"});case 28:for(j=e.sent,h=j.data,n.file(s.FileReferences.Physics,h),Fe(40),O=Object.keys(s.FileReferences.Motions).length,v=function(){f++,qe(t("live2d:pack_progress.download_motions",{total:O,dlcount:f})),Fe(40+Math.round(f/O*50))},qe(t("live2d:pack_progress.download_motions",{total:O,dlcount:f=0})),x=[],w=function(){var e=Object(d.a)(k[g],2),t=e[0],a=e[1];x.push(m.a.get("".concat(window.isChinaMainland?"https://sekai-assets-1258184166.file.myqcloud.com":"".concat("https://minio.dnaroma.eu","/sekai-assets"),"/live2d/motion/").concat(ne,"_rip/").concat(t,".motion3.json"),{responseType:"blob"}).then((function(e){var t=e.data;v(),n.file(a[0].File,t)})))},g=0,k=Object.entries(s.FileReferences.Motions);g<k.length;g++)w();return e.next=41,Promise.all(x);case 41:return qe(t("live2d:pack_progress.generate_zip")),e.next=44,n.generateAsync({type:"blob"});case 44:y=e.sent,Object(A.saveAs)(y,"".concat(Z,".zip")),Ce(!1),Fe(0),qe("");case 49:case"end":return e.stop()}}),e)}))),[fe,Z,ne,de,t]),rt=Object(u.useCallback)((function(){if(it.current){var e=it.current.toDataURL();Object(A.saveAs)(e)}}),[]),lt=Object(u.useCallback)(function(){var e=Object(l.a)(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!De){e.next=10;break}return e.next=3,Ue.finishAsync();case 3:n=e.sent,Object(A.saveAs)(n.blobURL),Ue.destroy(),Ge(void 0),Ve(!1),e.next=18;break;case 10:return Qe(t),e.next=13,V.a.createAsync(it.current,{mimeType:t});case 13:a=e.sent,Ge(a),a.start(),tt(void 0),Ve(!0);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[De,Ue]);return Object(a.jsxs)(u.Fragment,{children:[Object(a.jsx)(f.a,{variant:"h6",className:e.header,children:"Live2D"}),Object(a.jsx)(j.a,{severity:"warning",className:e.alert,children:t("common:betaIndicator")}),Object(a.jsxs)(v.a,{container:!0,spacing:1,alignItems:"center",children:[Object(a.jsx)(v.a,{item:!0,xs:9,md:4,lg:3,xl:2,children:Object(a.jsx)(h.a,{value:K,onChange:function(e,t){return X(t)},options:(null===nt||void 0===nt?void 0:nt.sort())||[],getOptionLabel:function(e){return e},renderInput:function(e){return Object(a.jsx)(x.a,Object(i.a)(Object(i.a)({},e),{},{label:t("live2d:select.model")}))}})}),Object(a.jsx)(v.a,{item:!0,xs:2,children:Object(a.jsx)(w.a,{disabled:!K,variant:"contained",onClick:function(){$(K),ae(((null===K||void 0===K?void 0:K.startsWith("sub"))?K:null===K||void 0===K?void 0:K.split("_")[0])+"_motion_base")},children:t("common:show")})})]}),Me&&Object(a.jsxs)(g.a,{className:e.content,children:[Object(a.jsx)(f.a,{children:ze}),Object(a.jsx)(k.a,{variant:"determinate",value:Re})]}),Object(a.jsxs)(g.a,{ref:at,className:e.content,children:[se&&Object(a.jsx)(y.a,{component:_.a,children:Object(a.jsxs)(v.a,{container:!0,spacing:1,alignItems:"center",children:[Object(a.jsxs)(v.a,{item:!0,children:[Object(a.jsx)(M.a,{title:t("live2d:tooltip.download"),children:Object(a.jsx)(C.a,{disabled:!se,onClick:ot,children:Object(a.jsx)(N.a,{fontSize:"inherit"})})}),Object(a.jsx)(M.a,{title:t("live2d:tooltip.fullscreen"),children:Pe?Object(a.jsx)(C.a,{disabled:!ct,onClick:function(){D.a.exitFullscreen()},children:Object(a.jsx)(L.a,{fontSize:"inherit"})}):Object(a.jsx)(C.a,{disabled:!ct,onClick:function(){D.a.requestFullscreen(at.current)},children:Object(a.jsx)(z.a,{fontSize:"inherit"})})}),Object(a.jsx)(M.a,{title:t("live2d:tooltip.shot"),children:Object(a.jsx)(C.a,{disabled:!se,onClick:rt,children:Object(a.jsx)(q.a,{fontSize:"inherit"})})}),window.MediaRecorder&&Object(a.jsxs)(u.Fragment,{children:[Object(a.jsx)(M.a,{title:t(De?"live2d:tooltip.stop_record":"live2d:tooltip.start_record"),children:Object(a.jsx)(C.a,{disabled:!se,onClick:function(e){De?lt(Ye):tt(e.currentTarget)},children:De?Object(a.jsx)(E.a,{fontSize:"inherit"}):Object(a.jsx)(I.a,{fontSize:"inherit"})})}),Object(a.jsxs)(S.a,{anchorEl:et,open:!!et,onClose:function(){return tt(void 0)},children:[Object(a.jsx)(T.a,{disabled:!window.MediaRecorder.isTypeSupported("video/webm; codecs=vp8"),onClick:function(){lt("video/webm; codecs=vp8")},children:"WebM VP8"}),Object(a.jsx)(T.a,{disabled:!window.MediaRecorder.isTypeSupported("video/webm; codecs=vp9"),onClick:function(){lt("video/webm; codecs=vp9")},children:"WebM VP9"}),Object(a.jsx)(T.a,{disabled:!window.MediaRecorder.isTypeSupported("video/webm; codecs=h264"),onClick:function(){lt("video/webm; codecs=h264")},children:"WebM H.264 (MKV)"}),Object(a.jsx)(T.a,{disabled:!window.MediaRecorder.isTypeSupported("video/webm; codecs=h265"),onClick:function(){lt("video/webm; codecs=h265")},children:"WebM H.265"})]})]})]}),Object(a.jsx)(v.a,{item:!0,children:Object(a.jsxs)(v.a,{container:!0,children:[Object(a.jsx)(h.a,{value:me,onChange:function(e,t){return je(t)},options:de,getOptionLabel:function(e){return e},renderInput:function(e){return Object(a.jsx)(x.a,Object(i.a)(Object(i.a)({},e),{},{label:t("live2d:select.motions")}))},style:{minWidth:"170px"}}),Object(a.jsx)(w.a,{disabled:!me,variant:"contained",onClick:function(){me&&se.startMotion({groupName:me,no:0,priority:3,autoIdle:!1,autoAppear:!1,fadeInTime:.5,fadeOutTime:.5})},children:t("common:apply")})]})}),Object(a.jsx)(v.a,{item:!0,children:Object(a.jsxs)(v.a,{container:!0,children:[Object(a.jsx)(h.a,{value:ge,onChange:function(e,t){return ke(t)},options:fe,getOptionLabel:function(e){return e},renderInput:function(e){return Object(a.jsx)(x.a,Object(i.a)(Object(i.a)({},e),{},{label:t("live2d:select.expressions")}))},style:{minWidth:"170px"}}),Object(a.jsx)(w.a,{disabled:!ge,variant:"contained",onClick:function(){ge&&se.startMotion({groupName:ge,no:0,priority:3,autoIdle:!1,autoAppear:!1,fadeInTime:.5,fadeOutTime:.5})},children:t("common:apply")})]})})]})}),Object(a.jsx)("canvas",{ref:it})]})]})}},292:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(198),i=Object(a.a)((function(e){return{header:{fontWeight:"bold"},content:{marginTop:e.spacing(3),marginBottom:e.spacing(3),marginLeft:"auto",marginRight:"auto"},alert:{margin:e.spacing(1,0)},bold:{fontWeight:e.typography.fontWeightBold},capitalize:{textTransform:"capitalize"},tabpanel:{padding:e.spacing("1%",0,0,0)},"grid-out":{padding:e.spacing("1%","0")}}}))}}]);