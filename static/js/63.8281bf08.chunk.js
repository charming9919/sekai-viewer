(this["webpackJsonpsekai-viewer"]=this["webpackJsonpsekai-viewer"]||[]).push([[63],{1075:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(29),c=a(5),i=a.n(c),o=a(309),s=a(9),u=a(11),l=a(0),d=a(1026),h=a(298),f=a(281),b=a(54),p=a(1039),m=a(535),g=a(214),k=a(327),j=a(356),x=a(236),v=a(238),O=a(290),S=a(1067),w=a.n(S),y=a(188),C=a(43),_=a.n(C),I=a(321),N=a(995),W=a(291),M=a(37),A=a(108),E=a(286),F=a(292);var L=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=2*e*(e-1),a=new Float64Array(t),n=0;n<t;n++)a[n]=Math.cos(n/(2*e)*Math.PI);return a}(32);function D(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,a=new Float64Array(t*t),n=0;n<t;n++)for(var r=0;r<t;r++){var c=4*(t*n+r);a[t*n+r]=.299*e[c+0]+.587*e[c+1]+.114*e[c+2]}for(var i=T(a,t),o=[],s=1;s<=8;s++)for(var u=1;u<=8;u++)o.push(i[32*s+u]);for(var l=o.slice().sort((function(e,t){return e-t}))[Math.floor(o.length/2)],d=0;d<o.length;d++)o[d]=o[d]>l?1:0;return o}function T(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,a=new Float64Array(t),n=1;n<t;n++)a[n]=1;a[0]=1/Math.sqrt(2);for(var r=new Float64Array(t*t),c=0;c<t;c++)for(var i=0;i<t;i++){for(var o=0,s=0;s<t;s++)for(var u=0;u<t;u++)o+=L[(2*s+1)*c]*L[(2*u+1)*i]*e[t*s+u];o*=a[c]*a[i]/4,r[t*c+i]=o}return r}function R(e,t){for(var a=0,n=0;n<e.length;n++)e[n]!==t[n]&&a++;return a}t.default=function(){var e=Object(F.a)(),t=Object(h.a)(),a=Object(y.a)().t,c=Object(l.useContext)(M.c),S=c.jwtToken,C=c.sekaiProfile,L=c.updateSekaiProfile,T=Object(A.e)(S).putSekaiCardList,U=Object(W.e)("cards"),P=Object(u.a)(U,1)[0],V=Object(l.useState)(!1),B=Object(u.a)(V,2),H=B[0],z=B[1],q=Object(l.useState)([]),J=Object(u.a)(q,2),K=J[0],Y=J[1],G=Object(l.useState)(!1),Z=Object(u.a)(G,2),$=Z[0],Q=Z[1],X=Object(l.useState)(!1),ee=Object(u.a)(X,2),te=ee[0],ae=ee[1],ne=Object(l.useState)(!1),re=Object(u.a)(ne,2),ce=re[0],ie=re[1],oe=Object(l.useState)(""),se=Object(u.a)(oe,2),ue=se[0],le=se[1],de=Object(l.useState)(!1),he=Object(u.a)(de,2),fe=he[0],be=he[1],pe=Object(l.useState)(""),me=Object(u.a)(pe,2),ge=me[0],ke=me[1],je=Object(l.useCallback)((function(e){if(e.target){var t=e.target.result;if(t&&"string"===typeof t){var a=new d.b;z(!0),a.load(t,Object(s.a)(i.a.mark((function e(){var t,n,r,c,s,u,l,h,f,b,p,m,g,k,j,x,v,O,S,w,y,C,I,W,M,A,E,F,L,T,U,V,B,H,q,J,K,G,Z,Q,X,ee,te,ae,ne,re,ce,ie,oe,se,ue,le,de,he,fe,be,pe,me;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Y([]),t=a.clone(),d.a.grayScale(a,t),n=new d.c(-1,-1,-1,-1),r=.75,c=0;case 6:if(!(c<t.getHeight())){e.next=15;break}for(s=0,u=0;u<t.getWidth();u++)4294967295===t.getIntColor(u,c)&&s++;if(!(s/t.getWidth()>=r)){e.next=12;break}return n.y1=c,e.abrupt("break",15);case 12:c++,e.next=6;break;case 15:l=t.getHeight();case 16:if(!(l>0)){e.next=25;break}for(h=0,f=t.getWidth();f>0;f--)4294967295===t.getIntColor(f,l)&&h++;if(!(h/t.getWidth()>=r)){e.next=22;break}return n.y2=l,e.abrupt("break",25);case 22:l--,e.next=16;break;case 25:n.height=n.y2-n.y1,b=.95,p=0;case 28:if(!(p<t.getWidth())){e.next=37;break}for(m=0,g=n.y1;g<n.y2;g++)4294967295===t.getIntColor(p,g)&&m++;if(!(m/n.height>=b)){e.next=34;break}return n.x1=p,e.abrupt("break",37);case 34:p++,e.next=28;break;case 37:k=t.getWidth();case 38:if(!(k>0)){e.next=47;break}for(j=0,x=n.y2;x>n.y1;x--)4294967295===t.getIntColor(k,x)&&j++;if(!(j/n.height>=b)){e.next=44;break}return n.x2=k,e.abrupt("break",47);case 44:k--,e.next=38;break;case 47:n.width=n.x2-n.x1,d.a.crop(t.clone(),t,n.x1,n.y1,n.width,n.height),v=a.clone(),d.a.crop(a,v,n.x1,n.y1,n.width,n.height),d.a.blackAndWhite(t.clone(),t,3),O=0,S=[],w=0,y=[],C=4294967295,I=0;case 58:if(!(I<t.getWidth())){e.next=88;break}W=[],M=[],A=!1,E=0;case 63:if(!(E<t.getHeight())){e.next=81;break}if(t.getIntColor(I,E)<C&&!A?(W.push(E),A=!0):t.getIntColor(I,E)>=C&&A&&(W.push(E),A=!1),!(2===W.length&&W[1]-W[0]>30)){e.next=71;break}return d.a.crop(t.clone(),t,0,W[1]+20,t.getWidth(),t.getHeight()),d.a.crop(v.clone(),v,0,W[1]+20,v.getWidth(),v.getHeight()),W=[],E=0,e.abrupt("continue",78);case 71:if(4!==W.length){e.next=78;break}if(F=W[1]-W[0]+W[3]-W[2],!(M.length&&Math.abs(F-M[M.length-1])>10)){e.next=75;break}return e.abrupt("continue",78);case 75:y.push(W[0]),M.push(F),W=[];case 78:E++,e.next=63;break;case 81:if(!M.length){e.next=85;break}return O=Math.round(M.slice(1).reduce((function(e,t){return e+t}),0)/(M.length-1)),Math.abs(M[0]-O)>10?y.unshift():Math.abs(M[0]-O)>=4&&(y[0]=y[0]-Math.abs(M[0]-O)),e.abrupt("break",88);case 85:I++,e.next=58;break;case 88:L=y[1]-20;case 89:if(!(L<t.getHeight())){e.next=100;break}for(T=[],U=[],V=!1,B=0;B<t.getWidth();B++)t.getIntColor(B,L)<C&&!V?(T.push(B),V=!0):t.getIntColor(B,L)>=C&&V&&(T.push(B),V=!1),4===T.length&&(S.push(T[0]),H=T[1]-T[0]+T[3]-T[2],U.push(H),T=[]);if(!U.length){e.next=97;break}return w=Math.round(U.reduce((function(e,t){return e+t}),0)/U.length),e.abrupt("break",100);case 97:L++,e.next=89;break;case 100:for(q=[],J=[],K=[],G=[],Z=Math.max(w,O)+4,S.forEach((function(e){y.forEach((function(t){var a=new d.b(Z,Z);d.a.crop(v,a,e,t,Z,Z),q.push(a);var n=new d.b;d.a.crop(a,n,Math.floor(.165*Z),Math.floor(.165*Z),Math.floor(.445*Z),Math.floor(.445*Z)),d.a.scale(n.clone(),n,32,32),d.a.grayScale(n.clone(),n);var r=D(n.data,32).join("");G.push(r);var c=a.clone();d.a.blackAndWhite(c.clone(),c,10),d.a.invertColors(c.clone(),c);var i=new d.b;d.a.crop(c,i,3,Z-27,Z-50,27),J.push(i);var o=new d.b;d.a.crop(c,o,Z-36,Z-36,26,26),K.push(o)}))})),Q=[],X=0,ee=q;X<ee.length;X++)te=ee[X],(ae=document.createElement("canvas")).width=te.getWidth(),ae.height=te.getHeight(),null===(ne=ae.getContext("2d"))||void 0===ne||ne.putImageData(te.loadImageData(),0,0),Q.push(ae.toDataURL());return e.next=110,_.a.get("".concat(window.isChinaMainland?"https://minio.dnaroma.eu/sekai-best-assets":"".concat("https://minio.dnaroma.eu","/sekai-best-assets"),"/chara_hash.json"));case 110:if(re=e.sent,ce=re.data,ie=[],G.forEach((function(e){var t=ce.map((function(t){return[t[0],R(t[1],e)]})).filter((function(e){return e[1]<=16})).sort((function(e,t){return e[1]-t[1]}));ie.push(t.length?t[0][1]<=10?t.slice(0,1):t:[["",64]])})),oe=[],se=[],!$){e.next=150;break}ue=Array.from({length:4}).map((function(){return Object(N.createWorker)({corePath:window.isChinaMainland?"".concat("https://sekai-best-assets-1258184166.file.myqcloud.com","/tesseract-core.").concat("object"===typeof WebAssembly?"wasm":"asm",".js"):"https://unpkg.com/tesseract.js-core@2.2.0/tesseract-core.".concat("object"===typeof WebAssembly?"wasm":"asm",".js"),workerPath:window.isChinaMainland?"".concat("https://sekai-best-assets-1258184166.file.myqcloud.com","/worker.min.js"):"https://unpkg.com/tesseract.js@2.1.4/dist/worker.min.js",langPath:window.isChinaMainland?"https://sekai-best-assets-1258184166.file.myqcloud.com":"https://tessdata.projectnaptha.com/4.0.0"})})),le=Object(N.createScheduler)(),de=Object(o.a)(ue),e.prev=120,de.s();case 122:if((he=de.n()).done){e.next=133;break}return fe=he.value,e.next=126,fe.load();case 126:return e.next=128,fe.loadLanguage("eng");case 128:return e.next=130,fe.initialize("eng");case 130:le.addWorker(fe);case 131:e.next=122;break;case 133:e.next=138;break;case 135:e.prev=135,e.t0=e.catch(120),de.e(e.t0);case 138:return e.prev=138,de.f(),e.finish(138);case 141:return e.next=143,Promise.all(J.map((function(e){var t=document.createElement("canvas");t.width=e.getWidth(),t.height=e.getHeight();var a=t.getContext("2d");return null===a||void 0===a||a.putImageData(e.loadImageData(),0,0),le.addJob("recognize",t.toDataURL())})));case 143:return be=e.sent,oe=be.map((function(e){return e.data.text})),e.next=147,Promise.all(K.map((function(e){var t=document.createElement("canvas");t.width=e.getWidth(),t.height=e.getHeight();var a=t.getContext("2d");return null===a||void 0===a||a.putImageData(e.loadImageData(),0,0),le.addJob("recognize",t.toDataURL())})));case 147:pe=e.sent,se=pe.map((function(e){return e.data.text})),le.terminate();case 150:me=Q.map((function(e,t){return{id:t+1,crop:e,full:ie[t].length?ie[t].map((function(e){return"".concat("https://minio.dnaroma.eu","/sekai-assets/thumbnail/chara_rip/").concat(e[0])})):[""],hashResults:ie[t],distances:ie[t].length?ie[t].map((function(e){return e[1]})):[0],level:oe.length&&Number(oe[t].replace(/.*Lv.(\d{1,2}).*/,"$1"))||1,masterRank:se.length&&Number(se[t])||0,cardIds:ie[t].length?ie[t].map((function(e){var t;return(null===(t=P.find((function(t){return e[0].includes(t.assetbundleName)})))||void 0===t?void 0:t.id)||-1})):[-1],useIndex:0,trained:!!ie[t].length&&ie[t][0][0].includes("after_training"),skillLevel:1,story1Unlock:!0,story2Unlock:!0}})),Y(me.filter((function(e){return 64!==e.distances[0]}))),z(!1);case 153:case"end":return e.stop()}}),e,null,[[120,135,138,141]])}))))}}}),[P,$]),xe=Object(l.useCallback)((function(e,t,a){var n=a.id,c=K.findIndex((function(e){return e.id===n})),i=K[c];i[t]=Number(e),Y([].concat(Object(r.a)(K.slice(0,c)),[i],Object(r.a)(K.slice(c+1))))}),[K]),ve=Object(l.useMemo)((function(){return[{field:"id",headerName:a("common:id"),width:80},{field:"crop",headerName:a("user:profile.import_card.table.row.cropped_image"),width:100,renderCell:function(e){return Object(n.jsx)("img",{src:e.value,style:{height:"64px",width:"64px"},alt:""})},align:"center"},{field:"bestMatch",headerName:a("user:profile.import_card.table.row.best_match"),width:100,renderCell:function(e){var t=e.getValue("useIndex");return(null===P||void 0===P?void 0:P.find((function(a){return a.id===e.getValue("cardIds")[t]})))?Object(n.jsxs)(f.a,{container:!0,direction:"column",alignItems:"center",children:[Object(n.jsx)("img",{src:e.getValue("full")[t],style:{height:"64px",width:"64px"},alt:"".concat((100*(1-e.getValue("distances")[t]/64)).toFixed(1),"%")}),Object(n.jsx)(b.a,{children:"".concat((100*(1-e.getValue("distances")[t]/64)).toFixed(1),"%")})]}):Object(n.jsx)(l.Fragment,{})},align:"center"},{field:"changeCard",headerName:a("user:profile.import_card.table.row.other_possible_result"),width:100*(Math.max.apply(Math,Object(r.a)(K.map((function(e){return e.hashResults.length}))))-1||.1),renderCell:function(e){var t=e.getValue("useIndex");return Object(n.jsx)(f.a,{container:!0,spacing:1,children:Array.from({length:e.getValue("distances").length}).map((function(e,t){return t})).filter((function(e){return e!==t})).map((function(t){return Object(n.jsx)(f.a,{item:!0,children:Object(n.jsxs)(f.a,{container:!0,direction:"column",alignItems:"center",children:[Object(n.jsx)("img",{src:e.getValue("full")[t],style:{height:"64px",width:"64px",cursor:"pointer"},alt:"".concat((100*(1-e.getValue("distances")[t]/64)).toFixed(1),"%"),onClick:function(){return xe(t,"useIndex",e.row)}}),Object(n.jsx)(b.a,{children:"".concat((100*(1-e.getValue("distances")[t]/64)).toFixed(1),"%")})]})},t)}))})}},{field:"level",headerName:a("card:cardLevel"),width:100,renderCell:function(e){return Object(n.jsx)(p.a,{value:e.value,type:"number",inputMode:"numeric",fullWidth:!0,onChange:function(t){return xe(t.target.value,"level",e.row)}})}},{field:"masterRank",headerName:a("user:profile.import_card.table.row.card_master_rank"),width:120,renderCell:function(e){return Object(n.jsx)(p.a,{value:e.value,type:"number",inputMode:"numeric",inputProps:{min:0,max:5},onChange:function(t){return xe(t.target.value,"masterRank",e.row)}})}},{field:"skillLevel",headerName:a("card:skillLevel"),width:120,renderCell:function(e){return Object(n.jsx)(p.a,{value:e.value,type:"number",inputMode:"numeric",inputProps:{min:0,max:5},onChange:function(t){return xe(t.target.value,"skillLevel",e.row)}})}},{field:"trained",headerName:a("card:trained"),width:120,renderCell:function(e){return Object(n.jsx)(m.a,{checked:e.value,onChange:function(t,a){return xe(a,"trained",e.row)}})}},{field:"story1Unlock",headerName:a("card:sideStory1Unlocked"),width:180,align:"center",renderCell:function(e){return Object(n.jsx)(m.a,{checked:e.value,onChange:function(t,a){return xe(a,"story1Unlock",e.row)}})}},{field:"story2Unlock",headerName:a("card:sideStory2Unlocked"),width:180,align:"center",renderCell:function(e){return Object(n.jsx)(m.a,{checked:e.value,onChange:function(t,a){return xe(a,"story2Unlock",e.row)}})}}]}),[a,K,P,xe]),Oe=Object(l.useCallback)(Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C){e.next=2;break}return e.abrupt("return");case 2:return ae(!0),e.prev=3,t=K.map((function(e){return{cardId:e.cardIds[e.useIndex],level:e.level,masterRank:e.masterRank,skillLevel:e.skillLevel,trained:e.trained,story1Unlock:e.story1Unlock,story2Unlock:e.story2Unlock}})).sort((function(e,t){return e.cardId-t.cardId})),e.next=7,T(C.id,t);case 7:C.cardList&&C.cardList.length&&(C.cardList.forEach((function(e){t.some((function(t){return t.cardId===e.cardId}))||t.push(e)})),t.sort((function(e,t){return e.cardId-t.cardId}))),L({cardList:t}),ke(a("user:profile.import_card.submit_success")),be(!0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),le(a("user:profile.import_card.submit_error")),ie(!0);case 17:ae(!1);case 18:case"end":return e.stop()}}),e,null,[[3,13]])}))),[T,K,C,a,L]);return Object(n.jsxs)(f.a,{container:!0,direction:"column",children:[Object(n.jsx)(E.a,{severity:"warning",className:e.alert,children:a("common:betaIndicator")}),Object(n.jsxs)(f.a,{container:!0,spacing:1,children:[Object(n.jsx)(f.a,{item:!0,xs:12,children:Object(n.jsxs)(f.a,{container:!0,children:[Object(n.jsx)("input",{accept:"image/png,image/jpeg",className:t.inputHidden,id:"upload-member-button",type:"file",onChange:function(e){if(e.target.files&&e.target.files.length){var t=e.target.files.item(0);if(null===t||void 0===t?void 0:t.type.startsWith("image/")){var a=new FileReader;a.onload=je,a.readAsDataURL(t),e.target.value=""}}},disabled:H||!P||!P.length}),Object(n.jsx)("label",{htmlFor:"upload-member-button",children:Object(n.jsx)(f.a,{container:!0,alignItems:"center",spacing:1,children:Object(n.jsx)(f.a,{item:!0,children:Object(n.jsx)(g.a,{variant:"outlined",component:"span",disabled:H||!P||!P.length,startIcon:H?Object(n.jsx)(k.a,{size:24}):Object(n.jsx)(w.a,{}),children:a("user:profile.import_card.import_button")})})})})]})}),Object(n.jsx)(f.a,{item:!0,xs:12,children:Object(n.jsx)(f.a,{container:!0,children:Object(n.jsx)(f.a,{item:!0,children:Object(n.jsx)(j.a,{title:Object(n.jsx)(b.a,{variant:"caption",style:{whiteSpace:"pre-line"},children:a("user:profile.import_card.enable_ocr_tooltip")}),arrow:!0,children:Object(n.jsx)(x.a,{children:Object(n.jsx)(v.a,{control:Object(n.jsx)(m.a,{checked:$,onChange:function(e){return Q(e.target.checked)}}),label:a("user:profile.import_card.enable_ocr")})})})})})}),Object(n.jsx)(f.a,{item:!0,xs:12,children:Object(n.jsx)(f.a,{container:!0,children:Object(n.jsx)(f.a,{item:!0,xs:12,style:{height:"600px"},children:Object(n.jsx)(I.a,{columns:ve,rows:K,disableColumnFilter:!0,disableColumnReorder:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,rowHeight:100,pageSize:100})})})}),Object(n.jsx)(f.a,{item:!0,xs:12,children:Object(n.jsx)(g.a,{variant:"contained",color:"primary",disabled:!K.length||te,onClick:Oe,fullWidth:!0,startIcon:te&&Object(n.jsx)(k.a,{size:24}),children:a("common:submit")})})]}),Object(n.jsx)(O.a,{open:ce,autoHideDuration:3e3,onClose:function(){ie(!1)},children:Object(n.jsx)(E.a,{onClose:function(){ie(!1)},severity:"error",children:ue})}),Object(n.jsx)(O.a,{open:fe,autoHideDuration:3e3,onClose:function(){be(!1)},children:Object(n.jsx)(E.a,{onClose:function(){be(!1)},severity:"success",children:ge})})]})}},291:function(e,t,a){"use strict";a.d(t,"k",(function(){return v})),a.d(t,"e",(function(){return O})),a.d(t,"d",(function(){return S})),a.d(t,"f",(function(){return w})),a.d(t,"h",(function(){return y})),a.d(t,"c",(function(){return _})),a.d(t,"i",(function(){return N})),a.d(t,"b",(function(){return W})),a.d(t,"j",(function(){return M})),a.d(t,"a",(function(){return A})),a.d(t,"g",(function(){return E})),a.d(t,"l",(function(){return F}));var n=a(309),r=a(5),c=a.n(r),i=a(9),o=a(11),s=a(43),u=a.n(s),l=a(0),d=a(319),h=a(318),f=a.n(h),b=a(93),p=a.n(b),m=a(295),g=a(45),k=a(19),j=a(49),x=new d.a;function v(e){var t=Object(l.useState)(e),a=Object(o.a)(t,2),n=a[0],r=a[1],c=Object(l.useRef)(n);return Object(l.useEffect)((function(){c.current=n}),[n]),[n,c,r]}function O(e){var t=Object(l.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.get("".concat(window.isChinaMainland?"https://sekai-json-1258184166.file.myqcloud.com/master":"https://sekai-world.github.io/sekai-master-db-diff","/").concat(t,".json"));case 2:return a=e.sent,n=a.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),a=Object(j.a)(e,t),n=a.data,r=a.error;return[n,!r&&!n,r]}var S={all:"All",vocaloid:g.a.t("unit_profile:piapro.name"),light_music_club:g.a.t("unit_profile:light_sound.name"),idol:g.a.t("unit_profile:idol.name"),school_refusal:g.a.t("unit_profile:school_refusal.name"),theme_park:g.a.t("unit_profile:theme_park.name"),street:g.a.t("unit_profile:street.name"),other:"Other"};function w(e){var t=O("gameCharacters"),a=Object(o.a)(t,1)[0],n=Object(g.c)(),r=n.assetT,c=n.assetI18n;return Object(l.useCallback)((function(t){if(a&&a.length){var n=a.find((function(e){return e.id===t})),i=["zh-CN","zh-TW","ko","ja","id","ms"];if(null===n||void 0===n?void 0:n.firstName)switch(e){case"original":return"".concat(n.firstName," ").concat(n.givenName);case"translated":return i.includes(c.language)?"".concat(r("character_name:".concat(t,".firstName"),n.firstName)," ").concat(r("character_name:".concat(t,".givenName"),n.givenName)):"".concat(r("character_name:".concat(t,".givenName"),n.givenName)," ").concat(r("character_name:".concat(t,".firstName"),n.firstName));case"both":return"".concat(n.firstName," ").concat(n.givenName," | ")+(i.includes(c.language)?"".concat(r("character_name:".concat(t,".firstName"),n.firstName)," ").concat(r("character_name:".concat(t,".givenName"),n.givenName)):"".concat(r("character_name:".concat(t,".givenName"),n.givenName)," ").concat(r("character_name:".concat(t,".firstName"),n.firstName)))}return null===n||void 0===n?void 0:n.givenName}}),[c.language,r,a,e])}function y(){var e=Object(l.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.get(""+"/".concat(t,".json"));case 2:return a=e.sent,n=a.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return[Object(j.a)("metas",e).data]}var C=new f.a({concurrency:1});function _(e,t){return I.apply(this,arguments)}function I(){return(I=Object(i.a)(c.a.mark((function e(t,a){var n,r,i,o,s,l,d=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>2&&void 0!==d[2]&&d[2],r=d.length>3&&void 0!==d[3]&&d[3],i=Modernizr.webplossless,o=n?"".concat("https://sekai-assets-1258184166.file.myqcloud.com","/").concat(t):r?"".concat("https://minio.dnaroma.eu","/sekai-assets/").concat(t):"".concat("https://sekai-res.dnaroma.eu","/file/sekai-assets/").concat(t),!t.endsWith(".webp")||i){e.next=25;break}return e.next=7,p.a.getItem(o);case 7:if(s=e.sent){e.next=21;break}return e.next=11,u.a.get(o,{responseType:"arraybuffer"});case 11:return l=e.sent,e.next=14,C.add((function(){return x.decode(new Uint8Array(l.data))}));case 14:return s=e.sent,e.next=17,p.a.setItem(o,s);case 17:case 21:return a&&a(s),e.abrupt("return",s);case 23:e.next=27;break;case 25:return a&&a(o),e.abrupt("return",o);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){var t=O("mobCharacters"),a=Object(o.a)(t,1)[0],r=O("character2ds"),s=Object(o.a)(r,1)[0],d=w(e);return Object(l.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t,r){var i,o,l,h,f,b,p,g,k,j,x,v,O,S,w,y,C,I;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={characters:[],actions:[]},s&&s.length&&a&&a.length&&t){e.next=3;break}return e.abrupt("return",i);case 3:return e.t0=u.a,e.next=6,_(t);case 6:return e.t1=e.sent,e.t2={responseType:"json"},e.next=10,e.t0.get.call(e.t0,e.t1,e.t2);case 10:if(o=e.sent,l=o.data,h=l.ScenarioId,f=l.AppearCharacters,b=l.Snippets,p=l.TalkData,g=l.SpecialEffectData,k=l.SoundData,j=l.FirstBgm,!(x=l.FirstBackground)){e.next=23;break}return e.t3=i.actions,e.t4=m.b.SpecialEffect,e.t5=m.c.WaitUnitilFinished,e.t6=j,e.next=20,_("scenario/background/".concat(x,"_rip/").concat(x,".webp"));case 20:e.t7=e.sent,e.t8={type:e.t4,isWait:e.t5,delay:0,seType:"ChangeBackground",body:e.t6,resource:e.t7},e.t3.push.call(e.t3,e.t8);case 23:if(!j){e.next=33;break}return e.t9=i.actions,e.t10=m.b.Sound,e.t11=m.c.WaitUnitilFinished,e.t12=m.d[0],e.next=30,_("sound/scenario/bgm/".concat(j,"_rip/").concat(j,".mp3"));case 30:e.t13=e.sent,e.t14={type:e.t10,isWait:e.t11,delay:0,playMode:e.t12,hasBgm:!0,hasSe:!1,bgm:e.t13,se:""},e.t9.push.call(e.t9,e.t14);case 33:i.characters=f.map((function(e){var t=s.find((function(t){return t.id===e.Character2dId}));switch(t.characterType){case"game_character":return{id:t.characterId,name:d(t.characterId)};case"mob":return{id:t.characterId,name:a.find((function(e){return e.id===t.characterId})).name}}})),v=Object(n.a)(b),e.prev=35,v.s();case 37:if((O=v.n()).done){e.next=105;break}S=O.value,w={},e.t15=S.Action,e.next=e.t15===m.b.Talk?43:e.t15===m.b.SpecialEffect?45:e.t15===m.b.Sound?76:101;break;case 43:return e.delegateYield(c.a.mark((function e(){var t,a,n,i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p[S.ReferenceIndex],a={id:0,name:""},t.TalkCharacters[0].Character2dId&&(n=s.find((function(e){return e.id===t.TalkCharacters[0].Character2dId})),a.id=n.characterId),a.name=t.WindowDisplayName,i=t.Voices.length?"sound/".concat(r?"card_":"","scenario/voice/").concat(h,"_rip/").concat(t.Voices[0].VoiceId,".mp3"):"",t.Voices.length&&t.Voices[0].VoiceId.startsWith("partvoice")&&(o=s.find((function(e){return e.id===t.TalkCharacters[0].Character2dId})),i="sound/scenario/part_voice/".concat(o.assetName,"_").concat(o.unit,"_rip/").concat(t.Voices[0].VoiceId,".mp3")),e.t0=S.Action,e.t1=S.ProgressBehavior===m.c.WaitUnitilFinished,e.t2=S.Delay,e.t3=a,e.t4=t.Body,!t.Voices.length){e.next=17;break}return e.next=14,_(i);case 14:e.t5=e.sent,e.next=18;break;case 17:e.t5="";case 18:e.t6=e.t5,w={type:e.t0,isWait:e.t1,delay:e.t2,chara:e.t3,body:e.t4,voice:e.t6};case 20:case"end":return e.stop()}}),e)}))(),"t16",44);case 44:return e.abrupt("break",102);case 45:if(y=g[S.ReferenceIndex],C=m.e[y.EffectType],e.t17=S.Action,e.t18=S.ProgressBehavior===m.c.WaitUnitilFinished,e.t19=S.Delay,e.t20=C,e.t21=y.StringVal,"FullScreenText"!==C){e.next=58;break}return e.next=55,_("sound/scenario/voice/".concat(h,"_rip/").concat(y.StringValSub,".mp3"));case 55:e.t22=e.sent,e.next=73;break;case 58:if("ChangeBackground"!==C){e.next=64;break}return e.next=61,_("scenario/background/".concat(y.StringValSub,"_rip/").concat(y.StringValSub,".webp"));case 61:e.t23=e.sent,e.next=72;break;case 64:if("Movie"!==C){e.next=70;break}return e.next=67,_("scenario/movie/".concat(y.StringVal,"_rip/").concat(y.StringVal.split("_")[0],".mp4"));case 67:e.t24=e.sent,e.next=71;break;case 70:e.t24="";case 71:e.t23=e.t24;case 72:e.t22=e.t23;case 73:return e.t25=e.t22,w={type:e.t17,isWait:e.t18,delay:e.t19,seType:e.t20,body:e.t21,resource:e.t25},e.abrupt("break",102);case 76:if(I=k[S.ReferenceIndex],e.t26=S.Action,e.t27=S.ProgressBehavior===m.c.WaitUnitilFinished,e.t28=S.Delay,e.t29=m.d[I.PlayMode],e.t30=!!I.Bgm,e.t31=!!I.Se,!I.Bgm){e.next=89;break}return e.next=86,_("sound/scenario/bgm/".concat(I.Bgm,"_rip/").concat(I.Bgm,".mp3"));case 86:e.t32=e.sent,e.next=90;break;case 89:e.t32="";case 90:if(e.t33=e.t32,!I.Se){e.next=97;break}return e.next=94,_("sound/scenario/se/se_pack00001_rip/".concat(I.Se,".mp3"));case 94:e.t34=e.sent,e.next=98;break;case 97:e.t34="";case 98:return e.t35=e.t34,w={type:e.t26,isWait:e.t27,delay:e.t28,playMode:e.t29,hasBgm:e.t30,hasSe:e.t31,bgm:e.t33,se:e.t35},e.abrupt("break",102);case 101:w={type:S.Action,isWait:S.ProgressBehavior===m.c.WaitUnitilFinished,delay:S.Delay};case 102:i.actions.push(w);case 103:e.next=37;break;case 105:e.next=110;break;case 107:e.prev=107,e.t36=e.catch(35),v.e(e.t36);case 110:return e.prev=110,v.f(),e.finish(110);case 113:return e.abrupt("return",i);case 114:case"end":return e.stop()}}),e,null,[[35,107,110,113]])})));return function(t,a){return e.apply(this,arguments)}}(),[s,d,a])}function W(){return(new Date).toLocaleDateString("en-US",{timeZone:"Asia/Tokyo"}).split("/").slice(0,2).join("/")}function M(){var e=Object(k.h)().search;return Object(l.useMemo)((function(){return new URLSearchParams(e)}),[e])}function A(e){for(var t=[],a=0;a<e;a+=1){for(var n="0123456789ABCDEF".split(""),r="#",c=0;c<6;c+=1)r+=n[Math.floor(16*Math.random())];t.push(r)}return t}function E(e,t){var a=Object(l.useState)((function(){try{var a=window.localStorage.getItem(e);return a?JSON.parse(a):t}catch(n){return console.log(n),t}})),n=Object(o.a)(a,2),r=n[0],c=n[1];return[r,function(t){try{var a=t instanceof Function?t(r):t;c(a),window.localStorage.setItem(e,JSON.stringify(a))}catch(n){console.log(n)}}]}function F(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(l.useReducer)((function(e){return!e}),e)}},295:function(e,t,a){"use strict";var n,r,c,i,o;a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"e",(function(){return c})),a.d(t,"d",(function(){return i})),a.d(t,"a",(function(){return o})),function(e){e[e.None=0]="None",e[e.Talk=1]="Talk",e[e.CharacerLayout=2]="CharacerLayout",e[e.InputName=3]="InputName",e[e.CharacterMotion=4]="CharacterMotion",e[e.Selectable=5]="Selectable",e[e.SpecialEffect=6]="SpecialEffect",e[e.Sound=7]="Sound"}(n||(n={})),function(e){e[e.Now=0]="Now",e[e.WaitUnitilFinished=1]="WaitUnitilFinished"}(r||(r={})),function(e){e[e.None=0]="None",e[e.BlackIn=1]="BlackIn",e[e.BlackOut=2]="BlackOut",e[e.WhiteIn=3]="WhiteIn",e[e.WhiteOut=4]="WhiteOut",e[e.ShakeScreen=5]="ShakeScreen",e[e.ShakeWindow=6]="ShakeWindow",e[e.ChangeBackground=7]="ChangeBackground",e[e.Telop=8]="Telop",e[e.FlashbackIn=9]="FlashbackIn",e[e.FlashbackOut=10]="FlashbackOut",e[e.ChangeCardStill=11]="ChangeCardStill",e[e.AmbientColorNormal=12]="AmbientColorNormal",e[e.AmbientColorEvening=13]="AmbientColorEvening",e[e.AmbientColorNight=14]="AmbientColorNight",e[e.PlayScenarioEffect=15]="PlayScenarioEffect",e[e.StopScenarioEffect=16]="StopScenarioEffect",e[e.ChangeBackgroundStill=17]="ChangeBackgroundStill",e[e.PlaceInfo=18]="PlaceInfo",e[e.Movie=19]="Movie",e[e.SekaiIn=20]="SekaiIn",e[e.SekaiOut=21]="SekaiOut",e[e.AttachCharacterShader=22]="AttachCharacterShader",e[e.SimpleSelectable=23]="SimpleSelectable",e[e.FullScreenText=24]="FullScreenText",e[e.StopShakeScreen=25]="StopShakeScreen",e[e.StopShakeWindow=26]="StopShakeWindow"}(c||(c={})),function(e){e[e.CrossFade=0]="CrossFade",e[e.Stack=1]="Stack",e[e.SpecialSePlay=2]="SpecialSePlay",e[e.Stop=3]="Stop"}(i||(i={})),function(e){e.PLAY_LIVE="play_live",e.WAITING_ROOM="waiting_room",e.COLLECT_COSTUME_3D="collect_costume_3d",e.COLLECT_STAMP="collect_stamp",e.READ_AREA_TALK="read_area_talk",e.SKILL_LEVEL_UP="skill_level_up",e.MASTER_RANK="master_rank",e.READ_CARD_EPISODE_FIRST="read_card_episode_first",e.READ_CARD_EPISODE_SECOND="read_card_episode_second"}(o||(o={}))}}]);