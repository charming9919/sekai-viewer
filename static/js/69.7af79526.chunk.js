(this["webpackJsonpsekai-viewer"]=this["webpackJsonpsekai-viewer"]||[]).push([[69],{1073:function(e,t,i){"use strict";i.r(t);var a=i(5),s=i.n(a),r=i(9),n=i(1),c=i(11),l=i(8),o=i(198),j=i(20),d=i(281),b=i(341),u=i(54),p=i(191),m=i(356),O=i(214),x=i(327),f=i(457),h=i(365),k=i(290),_=i(1069),v=i(440),g=i(1070),y=i(1071),w=i(379),S=i(394),C=i(0),P=i(188),U=i(942),z=i(993),I=i(108),A=i(286),F=i(37),T=Object(o.a)((function(e){var t;return{media:(t={},Object(l.a)(t,e.breakpoints.down("sm"),{paddingTop:"75%"}),Object(l.a)(t,e.breakpoints.up("md"),{paddingTop:"56.25%"}),Object(l.a)(t,"backgroundSize","contain"),Object(l.a)(t,"width","100%"),t)}}));t.default=function(){var e=Object(P.a)().t,t=Object(j.a)(),i=T(),a=Object(C.useContext)(F.c),l=a.jwtToken,o=a.sekaiProfile,M=a.updateSekaiProfile,B=Object(I.e)(l),E=B.getSekaiProfileMe,G=B.postSekaiProfileVerify,J=B.postSekaiProfileConfirm,N=B.putSekaiProfileUpdate,V=Object(C.useState)(!1),D=Object(c.a)(V,2),H=D[0],L=D[1],R=Object(C.useState)(!1),q=Object(c.a)(R,2),K=q[0],Q=q[1],W=Object(C.useState)(!1),X=Object(c.a)(W,2),Y=X[0],Z=X[1],$=Object(C.useState)(!1),ee=Object(c.a)($,2),te=ee[0],ie=ee[1],ae=Object(C.useState)(!1),se=Object(c.a)(ae,2),re=se[0],ne=se[1],ce=Object(C.useState)(""),le=Object(c.a)(ce,2),oe=le[0],je=le[1];return Object(C.useEffect)((function(){E().then((function(e){M(e)})).catch((function(e){"SekaiProfile.me.error.not-exist"===e.id&&M()}))}),[E,M]),Object(n.jsxs)(d.a,{container:!0,direction:"column",spacing:1,children:[Object(n.jsx)(d.a,{item:!0,xs:12,children:Object(n.jsxs)(d.a,{container:!0,spacing:1,alignItems:"center",children:[o?Object(n.jsxs)(C.Fragment,{children:[!o.sekaiUserProfile&&Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(b.a,{size:"small",color:"secondary",label:e("user:profile.label.sekai_id_not_verified")})}),!H&&Object(n.jsxs)(C.Fragment,{children:[Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(b.a,{size:"small",label:e("user:profile.label.sekai_user_id")})}),Object(n.jsx)(d.a,{item:!0,children:Object(n.jsxs)(d.a,{container:!0,alignItems:"center",children:[Object(n.jsx)(u.a,{children:o.sekaiUserId}),Object(n.jsx)(p.a,{size:"small",onClick:function(){return L(!0)},disabled:o.updateAvailable<=o.updateUsed,children:Object(n.jsx)(_.a,{})})]})}),o.sekaiUserProfile&&Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(m.a,{title:e("user:profile.label.update_left",{allowed:o.updateAvailable,used:o.updateUsed}),disableFocusListener:!0,arrow:!0,interactive:!0,children:Object(n.jsx)("span",{children:Object(n.jsxs)(O.a,{size:"small",onClick:function(){ne(!0),N(o.id).then(function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=M,e.next=3,E();case 3:e.t1=e.sent,(0,e.t0)(e.t1),ne(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},disabled:re||o.updateAvailable<=o.updateUsed,variant:"contained",color:"primary",children:[re?Object(n.jsx)(x.a,{size:24}):Object(n.jsx)(v.a,{}),e("user:profile.button.update_sekai_profile")]})})})})]})]}):!H&&Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(O.a,{variant:"contained",color:"primary",onClick:function(){return L(!0)},children:e("user:profile.button.bind_sekai_id")})}),H&&Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(w.c,{initialValues:{userid:(null===o||void 0===o?void 0:o.sekaiUserId)||""},onSubmit:function(){var t=Object(r.a)(s.a.mark((function t(i,a){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.setErrors,t.prev=1,t.next=4,G(i.userid);case 4:return t.t0=M,t.next=7,E();case 7:t.t1=t.sent,(0,t.t0)(t.t1),L(!1),t.next=17;break;case 12:t.prev=12,t.t2=t.catch(1),console.log(t.t2),ie(!0),je(e("user:profile.error.sekai_id_already_bind"));case 17:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e,i){return t.apply(this,arguments)}}(),children:function(e){var t=e.submitForm,i=e.isSubmitting;return Object(n.jsx)(C.Fragment,{children:Object(n.jsxs)(w.b,{children:[Object(n.jsx)(w.a,{component:S.b,name:"userid",type:"text",InputProps:{endAdornment:Object(n.jsxs)(f.a,{position:"end",children:[Object(n.jsxs)(p.a,{size:"small",onClick:function(){return t()},disabled:i,children:[Object(n.jsx)(g.a,{})," ",i&&Object(n.jsx)(x.a,{size:"inherit"})]}),Object(n.jsx)(p.a,{size:"small",onClick:function(){return L(!1)},children:Object(n.jsx)(y.a,{})})]})}}),Object(n.jsx)("input",{type:"submit",style:{display:"none"}})]})})}})})]})}),o&&!o.sekaiUserProfile&&Object(n.jsxs)(d.a,{container:!0,alignItems:"center",spacing:1,children:[Object(n.jsx)(d.a,{item:!0,children:Object(n.jsxs)(u.a,{children:[e("user:profile.label.sekai_id_verify_token"),":"," ",o.sekaiUserToken]})}),Object(n.jsx)(d.a,{item:!0,xs:12,alignItems:"center",spacing:1,children:Object(n.jsxs)(d.a,{container:!0,children:[Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(O.a,{variant:"contained",color:"primary",onClick:function(){return Q(!0)},disabled:Y,children:e("user:profile.button.verify_sekai_id")})}),Y&&Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(x.a,{size:24})})]})})]}),o&&o.sekaiUserProfile&&Object(n.jsxs)(d.a,{item:!0,container:!0,alignItems:"center",spacing:1,children:[Object(n.jsx)(d.a,{item:!0,xs:12,sm:6,lg:4,xl:3,children:Object(n.jsxs)(d.a,{container:!0,alignItems:"center",spacing:1,children:[Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(b.a,{size:"small",label:e("user:profile.label.sekai_user_name")})}),Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(u.a,{children:o.sekaiUserProfile.user.userGamedata.name})})]})}),Object(n.jsx)(d.a,{item:!0,xs:12,sm:6,lg:4,xl:3,children:Object(n.jsxs)(d.a,{container:!0,alignItems:"center",spacing:1,children:[Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(b.a,{size:"small",label:e("user:profile.label.sekai_user_rank")})}),Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(u.a,{children:o.sekaiUserProfile.user.userGamedata.rank})})]})}),Object(n.jsx)(d.a,{item:!0,xs:12,children:Object(n.jsxs)(d.a,{container:!0,alignItems:"center",spacing:1,children:[Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(b.a,{size:"small",label:e("user:profile.label.sekai_user_word")})}),Object(n.jsx)(d.a,{item:!0,children:Object(n.jsx)(u.a,{children:o.sekaiUserProfile.userProfile.word})})]})})]}),Object(n.jsxs)(U.AutoRotatingCarousel,{label:e("user:profile.label.sekai_id_verify"),open:K,onClose:function(){return Q(!1)},onStart:function(){Z(!0),J(o.id,o.sekaiUserId).then(Object(r.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=M,e.next=3,E();case 3:e.t1=e.sent,(0,e.t0)(e.t1),Z(!1);case 6:case"end":return e.stop()}}),e)})))).catch((function(){ie(!0),je(e("user:profile.error.sekai_id_verify_failed")),Z(!1)})),Q(!1)},mobile:z.isMobile,autoplay:!1,children:[Object(n.jsx)(U.Slide,{media:Object(n.jsx)(h.a,{image:"".concat(window.isChinaMainland?"https://minio.dnaroma.eu/sekai-best-assets":"".concat("https://minio.dnaroma.eu","/sekai-best-assets"),"/verify/step_1.png"),title:"sekai id verify step 1",className:i.media}),mediaBackgroundStyle:{backgroundColor:t.palette.primary.main},style:{backgroundColor:t.palette.primary.main},title:e("user:profile.label.sekai_id_verify_step_1_title"),subtitle:e("user:profile.label.sekai_id_verify_step_1_subtitle")}),Object(n.jsx)(U.Slide,{media:Object(n.jsx)(h.a,{image:"".concat(window.isChinaMainland?"https://minio.dnaroma.eu/sekai-best-assets":"".concat("https://minio.dnaroma.eu","/sekai-best-assets"),"/verify/step_2.png"),title:"sekai id verify step 2",className:i.media}),mediaBackgroundStyle:{backgroundColor:t.palette.primary.main},style:{backgroundColor:t.palette.primary.main},title:e("user:profile.label.sekai_id_verify_step_2_title"),subtitle:e("user:profile.label.sekai_id_verify_step_2_subtitle",{verify_token:null===o||void 0===o?void 0:o.sekaiUserToken})})]}),Object(n.jsx)(k.a,{open:te,autoHideDuration:3e3,onClose:function(){ie(!1)},children:Object(n.jsx)(A.a,{onClose:function(){ie(!1)},severity:"error",children:oe})})]})}}}]);